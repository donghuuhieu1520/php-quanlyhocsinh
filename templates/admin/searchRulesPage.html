{% extends "admin/BaseAdmin.html" %}
{% block title %}Tra cứu nề nếp{% endblock %}

{% block content %}
<div id="page-wrapper">
    <div class="container-fluid">
        <!-- Page Heading -->
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">
                    <i class="fa fa-search"></i> Tra cứu nề nếp
                </h1>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="col-lg-3 col-md-3">
                    <label><i class="fa fa-group"></i> Tra cuu theo</label>
                    <select class="form-control" id="select-range">
                        <option value="1">Học sinh</option>
                        <option value="2">Lớp</option>
                    </select>
                </div>
                <div class="col-lg-3 col-md-3" style="display: block;" id="div-select-student">
                    <label><i class="fa fa-user"></i> Họ tên <span id="span-hoten-loading"></span></label>
                    <input type="text" class="form-control" placeholder="Họ tên học sinh" id="inp-student-name" data-tr-mahs="">
                </div>
                <div class="col-lg-3 col-md-3" id="div-select-class" style="display: none">
                    <label><i class="fa fa-graduation-cap"></i> Chọn lớp <span id="span-lop-loading"></span></label>
                    <select class="form-control" id="select-class">
                        <option selected="selected" disabled="disabled">Chọn một lớp</option>
                        {% for class in manage_classes %}
                        <option value="{{ class.id }}">{{ class.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-lg-1" style="display: none">
                    <label><i class="fa fa-search"></i>Tìm kiếm</label>
                    <button class="btn btn-primary" id="btn-search">Tìm</button>
                </div>
            </div>
        </div>
        <br>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <button class="pull-right btn" style="background-color: transparent; color: gray"><i class="fa fa-download"></i></button>
                <div class="table-responsive" >
                    <table class="table table-bordered table-hover table-striped" id="table">
                        <thead style="background-color: #4caf50; color: #fff">
                        <tr>
                            <th>STT</th>
                            <th>Họ tên</th>
                            <th>Lớp</th>
                            <th>Hoạt động</th>
                            <th>Ngày</th>
                            <th>Cập nhật bởi</th>
                            <th>Đã gửi SMS</th>
                        </tr>
                        </thead>
                        <tbody id="tbody-result">
                        <tr>
                            <td colspan="7" style="text-align: center;">
                                <p class="text-muted" style="font-weight: bold"><i class="fa fa-info-circle"></i> Chưa có dữ liệu</p>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>

        <!-- /.row - table -->
    </div>
    <!-- /.container-fluid -->

</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
    $('.1').attr('class', 'active');
</script>

<script type="text/javascript">
    $(document).ready(function(){
        $('#select-range').change(function(){
            var select_range = $(this).val();
            if (select_range == '1') {
                $('#div-select-student').show();
                $('#div-select-class').hide();
            } else if (select_range == '2') {
                $('#div-select-student').hide();
                $('#div-select-class').show();
            }
        });
        $('#inp-student-name').keyup(_.throttle(function(){
            $('#inp-student-name').attr('data-tr-mahs', '');
            $('#inp-student-name').css('color','');

            var student_name = $(this).val().trim();
            if (student_name != '') {
                $.ajax({
                    url: "timkiemvipham_backend.php",
                    type: "POST",
                    dataType: "text",
                    data: {
                        flag: "1",
                        student_name: student_name
                    },
                    success: function(ketqua){
                        $('#tbl-search-suggestion').html(ketqua);
                        $('#div-search-suggesstion').show();
                    }
                })
            }
        }, 1000));

        $('#select-class').change(function(){
            $('#btn-search').click()    ;
        });
        $('#btn-search').click(function(){
            var select_range = $('#select-range').val();
            if (select_range == '1')
            {
                var mahs = $('#inp-student-name').attr('data-tr-mahs');
                if (mahs != '')
                {
                    $.ajax({
                        url: "timkiemvipham_backend.php",
                        type: "POST",
                        dataType: "text",
                        data: {
                            flag: "search",
                            student_id: mahs
                        },
                        success: function(ketqua){
                            $('#tbody-result').html(ketqua).hide().fadeIn();
                            $('#btn-search').removeAttr('disabled')
                            $('#btn-search').html('Tìm')
                            $('#span-hoten-loading').html('')
                        }, beforeSend: function(){
                            $('#btn-search').attr('disabled', 'disabled')
                            $('#btn-search').html('<i class="fa fa-pulse fa-spinner fa-fw"></i> Tìm')
                            $('#span-hoten-loading').html('<i class="fa fa-pulse fa-spinner fa-fw"></i>')
                        }
                    })
                }else{

                    $.snackbar({content: '<span class="fa-stack fa-xs"><i class="fa fa-circle fa-stack-2x i-background" ></i><i class="fa fa-times fa-stack-1x i-content text-danger"></i></span> Vui lòng nhập tên học sinh.'})
                }
            }else if(select_range == '2')
            {
                var class_name  = $('#select-class').val();
                if (class_name != '')
                {
                    $.ajax({
                        url: "timkiemvipham_backend.php",
                        type: "POST",
                        dataType: "text",
                        data: {
                            flag: "search",
                            student_class_name: class_name
                        },
                        success: function(ketqua){
                            $('#tbody-result').html(ketqua).hide().fadeIn();
                            $('#btn-search').removeAttr('disabled')
                            $('#span-lop-loading').html('')
                        }, beforeSend: function(){
                            $('#btn-search').attr('disabled', 'disabled')
                            $('#span-lop-loading').html('<i class="fa fa-pulse fa-spinner fa-fw"></i>')
                        }
                    })
                }else{

                    $.snackbar({content: '<span class="fa-stack fa-xs"><i class="fa fa-circle fa-stack-2x i-background" ></i><i class="fa fa-times fa-stack-1x i-content text-danger"></i></span> Vui lòng chọn lớp.'})
                }
            }

        })
    })
</script>
{% endblock %}
